///////////////////////////////////////////////////////////////////////////////////////////////////
///Библиотека примитивов
///////////////////////////////////////////////////////////////////////////////////////////////////
class PrimitiveManager: public Object
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    PrimitiveManager  (const DeviceManagerPtr&, const MaterialManagerPtr&);
    ~PrimitiveManager ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Создание примитивов
///////////////////////////////////////////////////////////////////////////////////////////////////    
    PrimitivePtr        CreatePrimitive        ();
    PrimitivePtr        CreatePrimitive        (const PrimitiveBuffersPtr&);
    PrimitiveBuffersPtr CreatePrimitiveBuffers (MeshBufferUsage lines_usage = MeshBufferUsage_Stream, MeshBufferUsage sprites_usage = MeshBufferUsage_Stream);    
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Проверка: является ли ресурс библиотекой мешей
///////////////////////////////////////////////////////////////////////////////////////////////////
    static bool IsMeshLibraryResource (const char* name);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Загрузка / выгрузка примитивов
///////////////////////////////////////////////////////////////////////////////////////////////////
    void LoadMeshLibrary   (const char* name);
    void LoadMeshLibrary   (const media::geometry::MeshLibrary&);
    void UnloadMeshLibrary (const char* name);
    void UnloadMeshLibrary (const media::geometry::MeshLibrary&);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Регистрация совместно используемых примитивов
///////////////////////////////////////////////////////////////////////////////////////////////////
    void SharePrimitive   (const char* name, const PrimitivePtr& primitive);
    void UnsharePrimitive (const char* name);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение прокси
///////////////////////////////////////////////////////////////////////////////////////////////////
    PrimitiveProxy GetPrimitiveProxy (const char* name); //создание прокси в случае отсутствия
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Поиск загруженного примитива
///////////////////////////////////////////////////////////////////////////////////////////////////
    PrimitivePtr FindPrimitive (const char* name);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка примитива по умолчанию
///////////////////////////////////////////////////////////////////////////////////////////////////
    void         SetDefaultPrimitive (const PrimitivePtr& primitive);
    PrimitivePtr DefaultPrimitive    ();
  
  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};
