///////////////////////////////////////////////////////////////////////////////////////////////////
///Типы параметров
///////////////////////////////////////////////////////////////////////////////////////////////////
enum ProgramParametersSlot
{
  ProgramParametersSlot_Frame,
  ProgramParametersSlot_FrameEntity,
  ProgramParametersSlot_Entity,
  ProgramParametersSlot_Material,
  ProgramParametersSlot_Program,
  
  ProgramParametersSlot_Num
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Параметры программы шейдинга
///////////////////////////////////////////////////////////////////////////////////////////////////
class ProgramParametersLayout: public Object, public xtl::trackable
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Порождающая функция
///////////////////////////////////////////////////////////////////////////////////////////////////
    static ProgramParametersLayoutPtr Create (const LowLevelDevicePtr& device, const SettingsPtr& settings);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    ~ProgramParametersLayout ();    

///////////////////////////////////////////////////////////////////////////////////////////////////
///Перечисление параметров
///////////////////////////////////////////////////////////////////////////////////////////////////
    const low_level::ProgramParametersLayoutDesc& Parameters ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение объекта расположения параметров низкоуровневого устройства отрисовки
///////////////////////////////////////////////////////////////////////////////////////////////////
    LowLevelProgramParametersLayoutPtr& DeviceLayout ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Хэш / отладочный идентификатор
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t Hash () const;
    size_t Id   () const;
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка параметров в соответствующие слоты
///////////////////////////////////////////////////////////////////////////////////////////////////
    void SetSlot       (ProgramParametersSlot slot, const common::PropertyLayout& layout);
    void AttachSlot    (ProgramParametersSlot slot, const common::PropertyMap& map);
    void ResetSlot     (ProgramParametersSlot slot);
    void ResetAllSlots ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Связывание параметров
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Attach    (const ProgramParametersLayout&);
    void Detach    (const ProgramParametersLayout&);
    void DetachAll ();

  private:
    ProgramParametersLayout (const LowLevelDevicePtr& device, const SettingsPtr& settings);

  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Менеджер параметров программ шэйдинга
///////////////////////////////////////////////////////////////////////////////////////////////////
class ProgramParametersManager: public xtl::noncopyable
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    ProgramParametersManager  (const LowLevelDevicePtr&, const SettingsPtr&, const CacheManagerPtr&);
    ~ProgramParametersManager ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение объекта параметров
///////////////////////////////////////////////////////////////////////////////////////////////////
    ProgramParametersLayoutPtr GetParameters (ProgramParametersSlot slot, const common::PropertyLayout& layout, bool is_temporary = false);
    ProgramParametersLayoutPtr GetParameters (const ProgramParametersLayout* layout1, const ProgramParametersLayout* layout2, const ProgramParametersLayout* layout3);

  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};
