///////////////////////////////////////////////////////////////////////////////////////////////////
///Материал
///////////////////////////////////////////////////////////////////////////////////////////////////
class MaterialImpl: public Object, public CacheSource
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    MaterialImpl  (const DeviceManagerPtr&, const TextureManagerPtr&, const ProgramManagerPtr&);
    ~MaterialImpl ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Идентификатор материала
///////////////////////////////////////////////////////////////////////////////////////////////////
    const char* Id    ();
    void        SetId (const char* id);    
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Блок состояний материала
///////////////////////////////////////////////////////////////////////////////////////////////////
    LowLevelStateBlockPtr StateBlock ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение объекта расположения параметров программы шейдинга
///////////////////////////////////////////////////////////////////////////////////////////////////
    ProgramParametersLayoutPtr ParametersLayout ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Программа шейдинга
///////////////////////////////////////////////////////////////////////////////////////////////////
    ProgramPtr Program ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение текстуры
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t                   TexturesCount ();
    TexturePtr               Texture       (size_t index); //может вернуть 0 в случае динамической текстуры
    LowLevelTexturePtr       DeviceTexture (size_t index); //может вернуть 0 в случае динамической текстуры
    const char*              TextureName   (size_t index);
    LowLevelSamplerStatePtr  Sampler       (size_t index);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Тэги
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t        TagsCount ();
    const size_t* Tags      ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Есть ли в материале динамические текстуры
///////////////////////////////////////////////////////////////////////////////////////////////////
    bool HasDynamicTextures ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Обновление материала
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Update (const media::rfx::Material&);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Управление кэшированием
///////////////////////////////////////////////////////////////////////////////////////////////////
    using CacheSource::UpdateCache;
    using CacheSource::ResetCache;
    
  private:
    void UpdateCacheCore ();
    void ResetCacheCore ();    

  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};
