///////////////////////////////////////////////////////////////////////////////////////////////////
///Буфер свойств
///////////////////////////////////////////////////////////////////////////////////////////////////
class PropertyBuffer: public CacheSource
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    PropertyBuffer  (const DeviceManagerPtr&);
    ~PropertyBuffer ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка свойств
///////////////////////////////////////////////////////////////////////////////////////////////////
    void                       SetProperties (const common::PropertyMap& properties);
    const common::PropertyMap& Properties    ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение буфера
///////////////////////////////////////////////////////////////////////////////////////////////////
    const LowLevelBufferPtr& Buffer ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Управление кэшированием
///////////////////////////////////////////////////////////////////////////////////////////////////
    using CacheSource::UpdateCache;
    using CacheSource::ResetCache;    
    
  private:
    void OnPropertiesUpdated ();
    void UpdateCacheCore ();
  
  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};
