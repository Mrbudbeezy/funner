///////////////////////////////////////////////////////////////////////////////////////////////////
///Типы параметров
///////////////////////////////////////////////////////////////////////////////////////////////////
enum ProgramParametersSlot
{
  ProgramParametersSlot_Frame,
  ProgramParametersSlot_Transformations,
  ProgramParametersSlot_Entity,
  ProgramParametersSlot_Material,
  
  ProgramParametersSlot_Num
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Менеджер параметров программ шэйдинга
///////////////////////////////////////////////////////////////////////////////////////////////////
class ProgramParametersManager: public xtl::noncopyable
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    ProgramParametersManager  (const LowLevelDevicePtr&);
    ~ProgramParametersManager ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Преобразование параметров
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Convert (const common::PropertyMap*          in_parameters [ProgramParametersSlot_Num],
                  LowLevelProgramParametersLayoutPtr& out_layout,
                  LowLevelBufferPtr                   out_constant_buffers [ProgramParametersSlot_Num]);

  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Параметры программы шейдинга
///////////////////////////////////////////////////////////////////////////////////////////////////
class ProgramParametersLayout: public Object
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    ProgramParametersLayout  (const LowLevelDevicePtr& device);
    ~ProgramParametersLayout ();    

///////////////////////////////////////////////////////////////////////////////////////////////////
///Перечисление параметров
///////////////////////////////////////////////////////////////////////////////////////////////////
    const low_level::ProgramParametersLayoutDesc& Parameters ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение объекта расположения параметров низкоуровневого устройства отрисовки
///////////////////////////////////////////////////////////////////////////////////////////////////
    LowLevelProgramParametersLayoutPtr& DeviceLayout ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Хэш
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t Hash () const;
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка параметров в соответствующие слоты
///////////////////////////////////////////////////////////////////////////////////////////////////
    void SetSlot       (ProgramParametersSlot slot, const common::PropertyLayout& layout);
    void ResetSlot     (ProgramParametersSlot slot);
    void ResetAllSlots ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Связывание параметров
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Attach    (const ProgramParametersLayout&);
    void Detach    (const ProgramParametersLayout&);
    void DetachAll ();

  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};

