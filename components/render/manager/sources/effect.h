///////////////////////////////////////////////////////////////////////////////////////////////////
///Режим сортировки примитивов в проходе
///////////////////////////////////////////////////////////////////////////////////////////////////
enum SortMode
{
  SortMode_FrontToBack, //сортировать от ближнего примитива к дальнему
  SortMode_BackToFront, //сортировать от дальнего примитива к ближнему
  SortMode_StateSwitch, //группировать примитивы с целью сокращения количества переключений состояний
  
  SortMode_Default = SortMode_StateSwitch
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Проход эффект рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
class EffectPass: public Object
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    EffectPass  (const DeviceManagerPtr& device_manager);
    ~EffectPass ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Состояния уровней устройства отрисовки
///////////////////////////////////////////////////////////////////////////////////////////////////
    void                                SetBlendState        (const LowLevelBlendStatePtr&);
    void                                SetDepthStencilState (const LowLevelDepthStencilStatePtr&);
    void                                SetRasterizerState   (const LowLevelRasterizerStatePtr&);
    const LowLevelBlendStatePtr&        BlendState           ();
    const LowLevelDepthStencilStatePtr& DepthStencilState    ();
    const LowLevelRasterizerStatePtr&   RasterizerState      ();    

///////////////////////////////////////////////////////////////////////////////////////////////////
///Блок состояний эффекта
///////////////////////////////////////////////////////////////////////////////////////////////////
    LowLevelStateBlockPtr StateBlock ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Тэги примитивов, которые войдут в проход
///////////////////////////////////////////////////////////////////////////////////////////////////
    void          SetTags   (const char* tags);
    void          SetTags   (const common::StringArray& tags);    
    size_t        TagsCount ();
    const char*   Tag       (size_t index);
    size_t        TagHash   (size_t index);
    const char**  Tags      ();
    const size_t* TagHashes ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Тип сортировки примитивов
///////////////////////////////////////////////////////////////////////////////////////////////////
    void             SetSortMode (render::SortMode mode);
    render::SortMode SortMode    ();

  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Эффект рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
class Effect: public Object
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    Effect  ();
    ~Effect ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Тэги фрейма: используются для рекурсивного рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
    void          SetTags   (const char* tags);
    void          SetTags   (const common::StringArray& tags);    
    size_t        TagsCount ();
    const char*   Tag       (size_t index);
    size_t        TagHash   (size_t index);
    const char**  Tags      ();
    const size_t* TagHashes ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Проходы рендеринга / вложенные эффекты
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t PassesCount         ();
    size_t ChildrenCount       ();
    size_t AddOperation        (const EffectPassPtr&); //returns order number of operation in rendering sequence
    size_t AddOperation        (const EffectPtr&);    //returns order number of operation in rendering sequence
    void   RemoveOperation     (size_t order_number);
    void   RemoveAllOperations ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Создание рендера эффекта
///////////////////////////////////////////////////////////////////////////////////////////////////
    EffectRendererPtr CreateRenderer ();

  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Рендер эффекта
///////////////////////////////////////////////////////////////////////////////////////////////////
class EffectRenderer: public Object
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    EffectRenderer  ();
    ~EffectRenderer ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Добавление операций в список отрисовки
///////////////////////////////////////////////////////////////////////////////////////////////////
    void AddOperations (const RendererOperationList&);
    void AddOperations (const EffectRendererPtr&);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Выполнение операций
///////////////////////////////////////////////////////////////////////////////////////////////////
    void ExecuteOperations ();

  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};
