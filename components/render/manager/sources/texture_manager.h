///////////////////////////////////////////////////////////////////////////////////////////////////
///Менеджер текстур
///////////////////////////////////////////////////////////////////////////////////////////////////
class TextureManager: public Object
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    TextureManager  (const DeviceManagerPtr&);
    ~TextureManager ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Создание текстур
///////////////////////////////////////////////////////////////////////////////////////////////////    
    TexturePtr CreateTexture (const char* name);
    TexturePtr CreateTexture (const media::Image& image, bool generate_mipmaps, const char* name = "");
    TexturePtr CreateTexture (const media::Image& image, TextureDimension dimension, bool generate_mipmaps, const char* name = "");
    TexturePtr CreateTexture (const media::CompressedImage& image, const char* name = "");
    TexturePtr CreateTexture (const media::CompressedImage& image, TextureDimension dimension, const char* name = "");
    TexturePtr CreateTexture (TextureDimension dimension, unsigned int width, unsigned int height, unsigned int depth, PixelFormat format, bool generate_mipmaps, const char* name = "");
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Проверка: является ли ресурс текстурой
///////////////////////////////////////////////////////////////////////////////////////////////////
    static bool IsTextureResource (const char* name);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Загрузка / выгрузка текстур
///////////////////////////////////////////////////////////////////////////////////////////////////
    void LoadTexture   (const char* name);
    void ShareTexture  (const char* name, const TexturePtr& texture);    
    void UnloadTexture (const char* name);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение прокси
///////////////////////////////////////////////////////////////////////////////////////////////////
    TextureProxy     GetTextureProxy     (const char* name); //создание прокси в случае отсутствия
    TextureDescProxy GetTextureDescProxy (const char* name); //создание прокси в случае отсутствия
    SamplerProxy     GetSamplerProxy     (const char* name); //создание прокси в случае отсутствия
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Поиск загруженной текстуры / сэмплера
///////////////////////////////////////////////////////////////////////////////////////////////////
    TexturePtr              FindTexture     (const char* name);
    LowLevelTextureDescPtr  FindTextureDesc (const char* name);
    LowLevelSamplerStatePtr FindSampler     (const char* name);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Создание динамической текстуры
///////////////////////////////////////////////////////////////////////////////////////////////////
    DynamicTexturePtr CreateDynamicTexture (const char* name, EntityImpl& entity);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Регистрация динамических текстур
///////////////////////////////////////////////////////////////////////////////////////////////////
    typedef RenderManager::DynamicTextureCreator DynamicTextureCreator;

    void RegisterDynamicTexture       (const char* name_mask, const DynamicTextureCreator& creator);
    void UnregisterDynamicTexture     (const char* name_mask);
    void UnregisterAllDynamicTextures ();
    bool IsDynamicTexture             (const char* name);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка текстуры по умолчанию / сэмплера по умолчанию
///////////////////////////////////////////////////////////////////////////////////////////////////
    void                    SetDefaultTexture     (const TexturePtr& texture);
    void                    SetDefaultTextureDesc (const LowLevelTextureDescPtr& desc);
    void                    SetDefaultSampler     (const LowLevelSamplerStatePtr& sampler);
    TexturePtr              DefaultTexture        ();
    LowLevelTextureDescPtr  DefaultTextureDesc    ();
    LowLevelSamplerStatePtr DefaultSampler        ();
  
  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};
