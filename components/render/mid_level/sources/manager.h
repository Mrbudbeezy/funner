///////////////////////////////////////////////////////////////////////////////////////////////////
///Реализация менеджера рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
class RenderManagerImpl: public Object
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    RenderManagerImpl  ();
    ~RenderManagerImpl ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Строка описания устройства рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
    const char* Description ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Создание окна рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
    WindowPtr CreateWindow (const char* name, syslib::Window& window, common::PropertyMap& properties);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Перебор окон рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t    WindowsCount ();
    WindowPtr Window       (size_t index);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Создание целей рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
    RenderTargetPtr CreateRenderBuffer       (size_t width, size_t height, PixelFormat format);
    RenderTargetPtr CreateDepthStencilBuffer (size_t width, size_t height);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Создание примитивов
///////////////////////////////////////////////////////////////////////////////////////////////////
    PrimitivePtr CreatePrimitive      ();
    PrimitivePtr CreatePrimitive      (const char* name, ResourceInstanceMode mode = ResourceInstanceMode_Default);
    FramePtr     CreateFrame          ();
    TexturePtr   CreateTexture        (const media::Image& image);
    TexturePtr   CreateTexture        (const media::Image& image, TextureDimension dimension);
    TexturePtr   CreateTexture2D      (size_t width, size_t height, PixelFormat format);
    TexturePtr   CreateTexture3D      (size_t width, size_t height, size_t depth, PixelFormat format);
    TexturePtr   CreateTextureCubemap (size_t size, PixelFormat format);
    MaterialPtr  CreateMaterial       ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Загрузка ресурсов
///////////////////////////////////////////////////////////////////////////////////////////////////
    ResourceLibraryPtr Load (const char* resource_name);
    ResourceLibraryPtr Load (const media::rfx::MaterialLibrary&);
    ResourceLibraryPtr Load (const media::rfx::EffectLibrary&);
    ResourceLibraryPtr Load (const media::geometry::MeshLibrary&);
    ResourceLibraryPtr Load (const media::rfx::ShaderLibrary&);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Регистрация на события
///////////////////////////////////////////////////////////////////////////////////////////////////
    typedef RenderManager::WindowEventHandler WindowEventHandler;

    xtl::connection RegisterWindowEventHandler (RenderManagerWindowEvent event, const WindowEventHandler& handler) const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение обёртки
///////////////////////////////////////////////////////////////////////////////////////////////////
    RenderManager Wrap ();

  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};
