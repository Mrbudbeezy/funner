#ifndef RENDER_MID_LEVEL_RENDERER2D_HEADER
#define RENDER_MID_LEVEL_RENDERER2D_HEADER

#include <render/mid_level/renderer.h>
#include <render/mid_level/common.h>

namespace media
{

//forward declarations
enum PixelFormat;
class Image;

}

namespace render
{

namespace mid_level
{

namespace renderer2d
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Режимы смешивания цветов при наложении спрайта
///////////////////////////////////////////////////////////////////////////////////////////////////
enum BlendMode
{
  BlendMode_None,        //без смешивания
  BlendMode_Translucent, //полупрозрачность
  BlendMode_Mask,        //наложение по маске - спрайт является маской при наложении
  BlendMode_Additive,    //аддитивное наложение

  BlendMode_Num 
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Спрайт
///////////////////////////////////////////////////////////////////////////////////////////////////
struct Sprite
{
  math::vec3f position;   //положение левого центра спрайта
  math::vec2f size;       //размер спрайта
  math::vec4f color;      //цвет спрайта
  math::vec2f tex_offset; //смещение начала спрайта в текстуре [0;1]
  math::vec2f tex_size;   //размер спрайта в текстуре [0;1]
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Список спрайтов
///////////////////////////////////////////////////////////////////////////////////////////////////
struct Primitive
{
  ITexture*    texture;       //базовая текстура
  math::mat4f  transform;     //матрица преобразования координат
  BlendMode    blend_mode;    //режим наложения  
  size_t       first_sprite;  //номер первого спрайта
  size_t       sprites_count; //количество спрайтов
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Пакет визуализации 2D-примитивов
///////////////////////////////////////////////////////////////////////////////////////////////////
struct Frame: public Frame
{
  math::vec2f size;             //логические размеры кадра
  size_t      primitives_count; //количество примитивов в кадре
  Primitive*  primitives;       //примитивы
  Sprite*     sprites;          //спрайты
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Двумерная текстура
///////////////////////////////////////////////////////////////////////////////////////////////////
class ITexture: virtual public IRenderTarget {};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Система рендеринга 2D-примитивов
///////////////////////////////////////////////////////////////////////////////////////////////////
class IRenderer: virtual public mid_level::IRenderer
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Создание ресурсов
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual ITexture* CreateTexture (const media::Image& image) = 0;
    virtual ITexture* CreateTexture (size_t width, size_t height, media::PixelFormat pixel_format) = 0;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Добавление кадра на отрисовку
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void AddFrame (Frame*) = 0;
};

}

}

}

#endif
