#ifndef RENDER_SCENE_RENDER_VIEWPORT_HEADER
#define RENDER_SCENE_RENDER_VIEWPORT_HEADER

#include <stl/string_fwd>

#include <render/common.h>

namespace scene_graph
{

//forward declaration
class Camera;

}

namespace render
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Слушатель событий области вывода
///////////////////////////////////////////////////////////////////////////////////////////////////
class IViewportListener
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///События
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void OnChangeName       (const char* new_name) {}
    virtual void OnChangeArea       (const Rect& new_area) {}
    virtual void OnChangeCamera     (scene_graph::Camera* new_camera) {}
    virtual void OnChangeZOrder     (int new_z_order) {}
    virtual void OnChangeActive     (bool new_state) {}
    virtual void OnChangeRenderPath (const char* new_path_name) {}
    virtual void OnChangeProperty   (const char* name, const char* new_value) {}
    virtual void OnDestroy          () {}

///////////////////////////////////////////////////////////////////////////////////////////////////
///Подсчёт ссылок
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void AddRef  () {}
    virtual void Release () {}
    
  protected:
    virtual ~IViewportListener () {}
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Область вывода
///////////////////////////////////////////////////////////////////////////////////////////////////
class Viewport
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструкторы / деструктор / присваивание
///////////////////////////////////////////////////////////////////////////////////////////////////
    Viewport  ();
    Viewport  (const Viewport&); //политика копирования - подсчёт ссылок
    ~Viewport ();

    Viewport& operator = (const Viewport&);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Имя области вывода
///////////////////////////////////////////////////////////////////////////////////////////////////
    void        SetName (const char* name);
    const char* Name    () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Идентификатор области вывода
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t Id () const;
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка пути рендеринга содержимого области вывода
///////////////////////////////////////////////////////////////////////////////////////////////////
    void        SetRenderPath  (const char* path_name);
    const char* RenderPath     () const;
    size_t      RenderPathHash () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Границы области вывода
///////////////////////////////////////////////////////////////////////////////////////////////////
    void        SetArea   (const Rect& rect);
    void        SetArea   (size_t left, size_t top, size_t width, size_t height);    
    void        SetOrigin (size_t left, size_t top);
    void        SetSize   (size_t width, size_t height);
    const Rect& Area      () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Управление порядком отрисовки областей вывода (отрисовка от наименьших номеров по увеличению номера)
///////////////////////////////////////////////////////////////////////////////////////////////////
    void SetZOrder (int z_order);
    int  ZOrder    () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Камера, связанная с областью вывода (политика владения - weak-reference)
///////////////////////////////////////////////////////////////////////////////////////////////////
    void                       SetCamera (scene_graph::Camera*);
    const scene_graph::Camera* Camera    () const;
          scene_graph::Camera* Camera    ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Управление активностью области вывода (неакивные области не участвуют в отрисовке)
///////////////////////////////////////////////////////////////////////////////////////////////////
    void SetActive  (bool state);
    bool IsActive   () const;
    void Activate   () { SetActive (true); }
    void Deactivate () { SetActive (false); }

///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка переменных рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
    void        SetProperty    (const char* name, const char* value);
    const char* GetProperty    (const char* name) const; //nothrow
    bool        HasProperty    (const char* name) const; //nothrow
    void        RemoveProperty (const char* name); //nothrow
    void        RemoveAllProperties (); //nothrow

///////////////////////////////////////////////////////////////////////////////////////////////////
///Работа со слушателями
///////////////////////////////////////////////////////////////////////////////////////////////////
    void AttachListener     (IViewportListener*);
    void DetachListener     (IViewportListener*);
    void DetachAllListeners ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Обмен
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Swap (Viewport&);

  private:
    struct Impl;
    Impl* impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Обмен
///////////////////////////////////////////////////////////////////////////////////////////////////
void swap (Viewport&, Viewport&);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка/чтение типизированных свойств
///////////////////////////////////////////////////////////////////////////////////////////////////
template <class T> void set_property (Viewport&, const char* name, const T& value);
template <class T> T    get_property (Viewport&, const char* name);
template <class T> T    get_property (Viewport&, const char* name, const T& default_value);

#include <render/detail/viewport.inl>

}

#endif
