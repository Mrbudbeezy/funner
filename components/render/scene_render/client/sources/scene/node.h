#ifndef RENDER_SCENE_CLIENT_IMPL_SCENE_NODE_SHARED_HEADER
#define RENDER_SCENE_CLIENT_IMPL_SCENE_NODE_SHARED_HEADER

#include <stl/auto_ptr.h>

#include <xtl/intrusive_ptr.h>
#include <xtl/reference_counter.h>
#include <xtl/trackable.h>

#include <sg/node.h>

#include "scene_object.h"

namespace render
{

namespace scene
{

namespace client
{

//forward declarations
class SceneManager;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Узел
///////////////////////////////////////////////////////////////////////////////////////////////////
class Node: protected SceneObject, public xtl::reference_counter, public xtl::trackable
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    Node  (scene_graph::Node&, SceneManager&, interchange::NodeType node_type = interchange::NodeType_Node);
    virtual ~Node ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Идентификатор узла / тип узла
///////////////////////////////////////////////////////////////////////////////////////////////////
    object_id_t           Id   () const;
    interchange::NodeType Type () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Исходный узел
///////////////////////////////////////////////////////////////////////////////////////////////////
    scene_graph::Node& SourceNode () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Менеджер сцены
///////////////////////////////////////////////////////////////////////////////////////////////////
    SceneManager& Scenes () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Указатель на сцену (может быть нулевым)
///////////////////////////////////////////////////////////////////////////////////////////////////
    Scene* SceneOwner    () const;
    void   SetSceneOwner (Scene*, bool need_notify);

  protected:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Реализация синхронизации
///////////////////////////////////////////////////////////////////////////////////////////////////
    void UpdateCore (client::Context&);

  private:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Имя объекта
///////////////////////////////////////////////////////////////////////////////////////////////////
    const char* NameCore ();

  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};

typedef xtl::intrusive_ptr<Node> NodePtr;

}

}

}

#endif
