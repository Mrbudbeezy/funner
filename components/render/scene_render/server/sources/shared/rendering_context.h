#ifndef RENDER_SCENE_SERVER_RENDERING_CONTEXT_SHARED_HEADER
#define RENDER_SCENE_SERVER_RENDERING_CONTEXT_SHARED_HEADER

#include <xtl/exception.h>

#include <shared/sg/traverse_result.h>

namespace render
{

namespace manager
{

//forward declarations
class Frame;

}

namespace scene
{

namespace server
{

//forward declarations
class Camera;
class RenderManager;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Контекст рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
class RenderingContext
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструкторы
///////////////////////////////////////////////////////////////////////////////////////////////////
    RenderingContext (manager::Frame& frame, server::RenderManager& render_manager, ITraverseResultCache& traverse_result_cache, server::Camera& camera, RenderingContext* parent = 0);
    RenderingContext (RenderingContext& context, manager::Frame& frame);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Родительский контекст
///////////////////////////////////////////////////////////////////////////////////////////////////
    RenderingContext* Parent () { return parent; }

///////////////////////////////////////////////////////////////////////////////////////////////////
///Текущий кадр
///////////////////////////////////////////////////////////////////////////////////////////////////
    manager::Frame& Frame () { return frame; }

///////////////////////////////////////////////////////////////////////////////////////////////////
///Результат обхода
///////////////////////////////////////////////////////////////////////////////////////////////////
    server::TraverseResult& TraverseResult ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Менеджер рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
    server::RenderManager& RenderManager () { return render_manager; }

///////////////////////////////////////////////////////////////////////////////////////////////////
///Камера
///////////////////////////////////////////////////////////////////////////////////////////////////
    server::Camera& Camera () { return camera; }

  private:
    RenderingContext (const RenderingContext&); //no implementation
    RenderingContext& operator = (const RenderingContext&); //no implementation

  private:
    RenderingContext*       parent;
    manager::Frame&         frame;
    server::RenderManager&  render_manager;
    server::TraverseResult* traverse_result;
    ITraverseResultCache&   traverse_result_cache;
    server::Camera&         camera;
};

#include <shared/detail/rendering_context.inl>

}

}

}

#endif
