#ifndef RENDER_SCENE_SERVER_SCREEN_MANAGER_SHARED_HEADER
#define RENDER_SCENE_SERVER_SCREEN_MANAGER_SHARED_HEADER

#include <stl/auto_ptr.h>

#include <xtl/rect.h>

#include <render/manager/common.h>

#include <render/scene/interchange/types.h>

namespace render
{

namespace manager
{

//forward declarations
class Frame;

}

namespace scene
{

namespace server
{

using interchange::object_id_t;

using manager::Rect;

//forward declarations
class RenderManager;
class Viewport;
class ViewportManager;
class WindowManager;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Экран
///////////////////////////////////////////////////////////////////////////////////////////////////
class Screen
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструкторы / деструктор / присваивание
///////////////////////////////////////////////////////////////////////////////////////////////////
    Screen  (const char* name, const char* init_string, WindowManager& window_manager, const RenderManager& render_manager, const ViewportManager& viewport_manager);
    Screen  (const Screen&);
    ~Screen ();

    Screen& operator = (const Screen&);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Имя экрана
///////////////////////////////////////////////////////////////////////////////////////////////////
    const char* Name () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Активность экрана
///////////////////////////////////////////////////////////////////////////////////////////////////
    void SetActive (bool active);
    bool IsActive  () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Область экрана
///////////////////////////////////////////////////////////////////////////////////////////////////
    void        SetArea (const Rect&);
    const Rect& Area    () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Задний фон
///////////////////////////////////////////////////////////////////////////////////////////////////
    void               SetBackground   (bool state, const math::vec4f& color);
    bool               BackgroundState () const;
    const math::vec4f& BackgroundColor () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Связывание с областями вывода
///////////////////////////////////////////////////////////////////////////////////////////////////
    Viewport AttachViewport (object_id_t id);
    void     DetachViewport (object_id_t id);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Обновление
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Update (manager::Frame* parent_frame = 0);

  private:
    struct Impl;
    Impl* impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Менеджер экранов
///////////////////////////////////////////////////////////////////////////////////////////////////
class ScreenManager
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    ScreenManager  (WindowManager&, const RenderManager& render_manager, const ViewportManager& viewport_manager);
    ~ScreenManager ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение экрана / получение области вывода
///////////////////////////////////////////////////////////////////////////////////////////////////
    Screen&   GetScreen   (object_id_t id);
    Viewport& GetViewport (object_id_t id);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Создание экрана / удаление экрана
///////////////////////////////////////////////////////////////////////////////////////////////////
    Screen CreateScreen (object_id_t id, const char* name, const char* init_string);
    void   RemoveScreen (object_id_t id);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Максимальный уровень вложенности рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
    void   SetMaxDrawDepth (size_t level);
    size_t MaxDrawDepth    () const;

  private:
    ScreenManager (const ScreenManager&); //no impl
    ScreenManager& operator = (const ScreenManager&); //no impl

  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};

}

}

}

#endif
