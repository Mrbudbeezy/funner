#ifndef RENDER_SCENE_SERVER_RENDER_TARGET_MAP_SHARED_HEADER
#define RENDER_SCENE_SERVER_RENDER_TARGET_MAP_SHARED_HEADER

#include <render/manager/bounds.h>

namespace render
{

namespace scene
{

namespace server
{

//forward declarations
class RenderTargetMap;

using manager::Rect;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Описание цели рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
class RenderTargetDesc
{
  friend class RenderTargetMap;
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструкторы / деструктор / присваивание
///////////////////////////////////////////////////////////////////////////////////////////////////
    RenderTargetDesc  (const char* name, const manager::RenderTarget& target, const Rect& rect);
    RenderTargetDesc  (const RenderTargetDesc&);
    ~RenderTargetDesc ();  

    RenderTargetDesc& operator = (const RenderTargetDesc&);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Имя
///////////////////////////////////////////////////////////////////////////////////////////////////
    const char* Name () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Цель рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
    const manager::RenderTarget& Target    () const;
          manager::RenderTarget& Target    ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Область вывода
///////////////////////////////////////////////////////////////////////////////////////////////////
    const Rect& Area () const;

  private:
    void SetTarget (const manager::RenderTarget&);
    void SetArea (const Rect& rect);

  private:
    struct Impl;
    Impl* impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Слушатель карты целей рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
class IRenderTargetMapListener
{
  public:
    virtual void OnRenderTargetAdded   (const RenderTargetDesc& desc) = 0;
    virtual void OnRenderTargetUpdated (const RenderTargetDesc& desc) = 0;
    virtual void OnRenderTargetRemoved (const RenderTargetDesc& desc) = 0;

  protected:
    virtual ~IRenderTargetMapListener () {}
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Карта целей рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
class RenderTargetMap
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструкторы / деструктор / присваивание
///////////////////////////////////////////////////////////////////////////////////////////////////
    RenderTargetMap  ();
    RenderTargetMap  (const RenderTargetMap&);
    ~RenderTargetMap ();

    RenderTargetMap& operator = (const RenderTargetMap&);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Количество целей
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t Size () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Поиск по имени
///////////////////////////////////////////////////////////////////////////////////////////////////
    const RenderTargetDesc* Find (const char* name) const;
          RenderTargetDesc* Find (const char* name);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Добавление целей 
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Add (const char* name, const manager::RenderTarget& target, const Rect& rect);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Обновление целей 
///////////////////////////////////////////////////////////////////////////////////////////////////
    void SetRenderTarget (const char* name, const manager::RenderTarget& target);
    void SetArea         (const char* name, const Rect& rect);
    void SetArea         (const Rect& rect); //for all render targets

///////////////////////////////////////////////////////////////////////////////////////////////////
///Удаление целей
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Remove (const char* name);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Очистка
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Clear ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Принудительное оповещение об обновлении целей рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
    void ForceUpdateNotify ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Добавление слушателей
///////////////////////////////////////////////////////////////////////////////////////////////////
    void AttachListener     (IRenderTargetMapListener*);
    void DetachListener     (IRenderTargetMapListener*);
    void DetachAllListeners ();

  private:
    struct Impl;
    Impl* impl;
};

}

}

}

#endif
