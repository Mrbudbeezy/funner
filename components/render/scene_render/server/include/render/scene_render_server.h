#ifndef SCENE_RENDER_SERVER_HEADER
#define SCENE_RENDER_SERVER_HEADER

#include <stl/auto_ptr.h>

namespace syslib
{

//forward declaration
class Window;

}

namespace common
{

//forward declaration
class PropertyMap;
class ParseNode;

}

namespace render
{

namespace scene
{

namespace server
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Режим работы сервера
///////////////////////////////////////////////////////////////////////////////////////////////////
enum ServerThreadingModel
{
  ServerThreadingModel_SingleThreaded,
  ServerThreadingModel_MultiThreaded,

  ServerThreadingModel_Default = ServerThreadingModel_MultiThreaded
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Сервер рендеринга
///////////////////////////////////////////////////////////////////////////////////////////////////
class Server
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    Server  (const char* name, ServerThreadingModel model = ServerThreadingModel_Default);
    ~Server ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Присоединение окон
///////////////////////////////////////////////////////////////////////////////////////////////////
    void AttachWindow     (const char* name, syslib::Window& window, const common::PropertyMap& properties);
    void AttachWindow     (const char* name, syslib::Window& window, const common::ParseNode& properties);
    void DetachWindow     (const char* name);
    void DetachAllWindows ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Ожидание незавершенных операций
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Finish    ();
    void Finish    (size_t timeout_ms);
    bool TryFinish (size_t timeout_ms);

  private:
    Server (const Server&); //no impl
    Server& operator = (const Server&); //no impl

  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};

}

}

using scene::server::Server;

}

#endif
