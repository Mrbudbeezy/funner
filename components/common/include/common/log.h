#ifndef COMMONLIB_LOG_HEADER
#define COMMONLIB_LOG_HEADER

#include <xtl/functional_fwd>

namespace common
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Именованный генератор лог-сообщений
///////////////////////////////////////////////////////////////////////////////////////////////////
class Log
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор/деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    Log  (const char* name);
    Log  (const Log&);
    ~Log ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Присваивание
///////////////////////////////////////////////////////////////////////////////////////////////////
    Log& operator = (const Log&);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение имени
///////////////////////////////////////////////////////////////////////////////////////////////////
    const char* Name () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Печать сообщений
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Print   (const char* message) const;
    void Printf  (const char* message, ...) const;
    void VPrintf (const char* message, va_list list) const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Обмен
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Swap (Log&);

  private:
    struct Impl;
    Impl* impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Обмен
///////////////////////////////////////////////////////////////////////////////////////////////////
void swap (Log&, Log&);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Система логгирования
///////////////////////////////////////////////////////////////////////////////////////////////////
class LogSystem
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Регистрация подписчиков на сообщения от групп
///////////////////////////////////////////////////////////////////////////////////////////////////
    typedef xtl::function<void (const char* log_name, const char* message)> LogHandler;

    static xtl::connection RegisterLogHandler (const char* log_name_mask, const LogHandler& handler);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Отсылка лог сообщения
///////////////////////////////////////////////////////////////////////////////////////////////////
    static void Print   (const char* log_name, const char* message);
    static void Printf  (const char* log_name, const char* message, ...);
    static void VPrintf (const char* log_name, const char* message, va_list list);
};

}

#endif
