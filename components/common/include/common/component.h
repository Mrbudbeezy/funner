#ifndef COMMONLIB_COMPONENT_HEADER
#define COMMONLIB_COMPONENT_HEADER

#include <xtl/functional_fwd>

namespace xtl
{

//forward declaration
template <class T> class iterator;

}

namespace common
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Интерфейс компонента
///////////////////////////////////////////////////////////////////////////////////////////////////
class IComponent
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Имя
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual const char* Name () = 0;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Загрузка / выгрузка компонента
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void Load   () = 0;
    virtual void Unload () = 0;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Состояние компонента
///////////////////////////////////////////////////////////////////////////////////////////////////
class IComponentState
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Имя
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual const char* Name () = 0;
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Загружен ли компонент
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual bool IsLoaded () = 0;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Менеджер компонентов
///////////////////////////////////////////////////////////////////////////////////////////////////
class ComponentManager
{
  public:
    typedef xtl::function<void (const char*)> LogHandler;
    typedef xtl::iterator<IComponentState>    Iterator;
  
///////////////////////////////////////////////////////////////////////////////////////////////////
///Регистрация компонента
///////////////////////////////////////////////////////////////////////////////////////////////////
    static void Register   (IComponent* component);
    static void Unregister (IComponent* component);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Загрузка компонентов
///////////////////////////////////////////////////////////////////////////////////////////////////
    static void Load   (const char* wc_component_mask);
    static void Load   (const char* wc_component_mask, const LogHandler& log);
    static void Unload (const char* wc_component_mask);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Перебор компонентов
///////////////////////////////////////////////////////////////////////////////////////////////////
    static Iterator CreateIterator ();
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Компонент, автоматически регистрирующийся в менеджере компонентов
///////////////////////////////////////////////////////////////////////////////////////////////////
class AutoRegisteredComponent: public IComponent
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    AutoRegisteredComponent  ();
    ~AutoRegisteredComponent ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Загрузка / выгрузка по умолчанию
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Load   () {}
    void Unload () {}
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Загрузчик компонентов
///////////////////////////////////////////////////////////////////////////////////////////////////
class ComponentLoader
{
  public:
    ComponentLoader (const char* wc_component_mask);
};

}

#endif
