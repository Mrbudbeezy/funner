#ifndef SCENE_GRAPH_CONTROLLER_HEADER
#define SCENE_GRAPH_CONTROLLER_HEADER

#include <typeinfo>

#include <xtl/any_reference.h>
#include <xtl/functional_fwd>

namespace scene_graph
{

//forward declaration
class Node;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Интерфейс динамического обновления состояния узла
///////////////////////////////////////////////////////////////////////////////////////////////////
class IController
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual ~IController () {}

///////////////////////////////////////////////////////////////////////////////////////////////////
///Обновление состояния контролируемого узла
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void Update (float dt) = 0;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Менеджер контроллеров
///////////////////////////////////////////////////////////////////////////////////////////////////
class ControllerManager
{
  public:
    typedef xtl::function<IController* (Node& node, const xtl::any_reference& param)> ControllerCreator;
  
///////////////////////////////////////////////////////////////////////////////////////////////////
///Регистрация функторов создания контроллера
///////////////////////////////////////////////////////////////////////////////////////////////////
    static void Register      (const char* name, const ControllerCreator& creator);
    static void Unregister    (const char* name);
    static void UnregisterAll ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Зарегистрирован ли контроллер
///////////////////////////////////////////////////////////////////////////////////////////////////
    static bool IsPresent (const char* name);
};

}

#endif
