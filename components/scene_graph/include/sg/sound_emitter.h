#ifndef SCENE_GRAPH_SOUND_EMITTER_HEADER
#define SCENE_GRAPH_SOUND_EMITTER_HEADER

#include <xtl/functional_fwd>
#include <sg/entity.h>

namespace scene_graph
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///События источника звука
///////////////////////////////////////////////////////////////////////////////////////////////////
enum SoundEmitterEvent
{
  SoundEmitterEvent_OnPlay,     //срабатывает при начале проигрывания
  SoundEmitterEvent_OnStop,     //срабатывает при остановке проигрывания

  SoundEmitterEvent_Num
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Источник звука
///////////////////////////////////////////////////////////////////////////////////////////////////
class SoundEmitter : public Entity
{
  public:  
    typedef xtl::com_ptr <SoundEmitter> Pointer;
    typedef xtl::com_ptr <const SoundEmitter> ConstPointer;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Создание источника звука
///////////////////////////////////////////////////////////////////////////////////////////////////
    static Pointer Create (const char* sound_declaration_name);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Имя звука
///////////////////////////////////////////////////////////////////////////////////////////////////
    const char* SoundDeclarationName () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Проигрывание
///////////////////////////////////////////////////////////////////////////////////////////////////
    void  Play            (float play_start_offset = 0.f);
    float PlayStartOffset () const;
    void  Stop            ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Управление громкостью
///////////////////////////////////////////////////////////////////////////////////////////////////
    void  SetGain (float gain);
    float Gain    ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Подписка на события SoundEmitter
///////////////////////////////////////////////////////////////////////////////////////////////////
    typedef xtl::function<void (SoundEmitter& sender, SoundEmitterEvent event)> EventHandler;

    xtl::connection RegisterEventHandler (SoundEmitterEvent, const EventHandler& handler) const;
    
    using Entity::RegisterEventHandler;

  protected:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    SoundEmitter  (const char* sound_declaration_name);
    ~SoundEmitter ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Метод, вызываемый при посещении данного объекта
///////////////////////////////////////////////////////////////////////////////////////////////////
    void AcceptCore (Visitor&);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Связывание свойств узла с методами узла
///////////////////////////////////////////////////////////////////////////////////////////////////
    void BindProperties (common::PropertyBindingMap& bindings);

  private:
    struct Impl;
    Impl* impl;
};

}

#endif
