#ifndef SOCIAL_SESSION_HEADER
#define SOCIAL_SESSION_HEADER

#include <cstddef>

#include <xtl/functional_fwd>

#include <social/achievement.h>
#include <social/common.h>
#include <social/leaderboard.h>
#include <social/user.h>

namespace common
{

//forward declaration
class PropertyMap;

}

namespace social
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Сессия
///////////////////////////////////////////////////////////////////////////////////////////////////
class Session
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор / копирование
///////////////////////////////////////////////////////////////////////////////////////////////////
    Session (const char* session_name);
    Session (const Session& source);
    ~Session ();

    Session& operator = (const Session& source);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Описание сессии
///////////////////////////////////////////////////////////////////////////////////////////////////
    const char* Description () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Логин
///////////////////////////////////////////////////////////////////////////////////////////////////
    void LogIn      (const common::PropertyMap& config);
    void LogOut     ();
    bool IsLoggedIn () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Показ стандартных окон
///////////////////////////////////////////////////////////////////////////////////////////////////
    void ShowWindow (const char* window_name, const common::PropertyMap& properties = common::PropertyMap ()) const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение залогиненного пользователя
///////////////////////////////////////////////////////////////////////////////////////////////////
          User& CurrentUser ();
    const User& CurrentUser () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Загрузка пользователя по идентификатору
///////////////////////////////////////////////////////////////////////////////////////////////////
    void LoadUser (const char* id, const IUserManager::LoadUserCallback& callback, const common::PropertyMap& properties = common::PropertyMap ()) const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Аватар
///////////////////////////////////////////////////////////////////////////////////////////////////
    void LoadUserPicture (const User& user, const IUserManager::LoadPictureCallback& callback, const common::PropertyMap& properties = common::PropertyMap ()) const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Друзья
///////////////////////////////////////////////////////////////////////////////////////////////////
    void LoadFriendsIds (const User& id, const IUserManager::LoadFriendsIdsCallback& callback, const common::PropertyMap& properties = common::PropertyMap ()) const;
    void LoadFriends    (const User& id, const IUserManager::LoadFriendsCallback& callback, const common::PropertyMap& properties = common::PropertyMap ()) const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Достижения
///////////////////////////////////////////////////////////////////////////////////////////////////
    void LoadAchievements       (const IAchievementManager::LoadAchievementsCallback& callback, const common::PropertyMap& properties = common::PropertyMap ()) const;
    void LoadAchievementPicture (const Achievement& achievement, const IAchievementManager::LoadPictureCallback& callback, const common::PropertyMap& properties = common::PropertyMap ()) const;
    void ReportAchievement      (const Achievement& achievement, const IAchievementManager::ReportCallback& callback, const common::PropertyMap& properties = common::PropertyMap ()) const;
      //report -> send

///////////////////////////////////////////////////////////////////////////////////////////////////
///Таблицы рекордов
///////////////////////////////////////////////////////////////////////////////////////////////////
    void LoadLeaderboardsIds (const ILeaderboardManager::LoadLeaderboardsCallback& callback, const common::PropertyMap& properties = common::PropertyMap ()) const;
    void LoadLeaderboard     (const char* leaderboard_id, const ILeaderboardManager::LoadLeaderboardCallback& callback, const common::PropertyMap& properties = common::PropertyMap ()) const;
    void LoadLeaderboard     (const char* leaderboard_id, const char* user_id, const ILeaderboardManager::LoadLeaderboardCallback& callback, const common::PropertyMap& properties = common::PropertyMap ()) const;
    void ReportScore         (const Score& score, const ILeaderboardManager::ReportScoreCallback& callback, const common::PropertyMap& properties = common::PropertyMap ()) const;
    
    //add swap

  private:
    struct Impl;
    Impl* impl;
};

//add swap

///////////////////////////////////////////////////////////////////////////////////////////////////
///Менеджер сессий
///////////////////////////////////////////////////////////////////////////////////////////////////
class SessionManager
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Регистрация создателей сессий
///////////////////////////////////////////////////////////////////////////////////////////////////
    typedef xtl::function<ISessionManager* (const char* name, const common::PropertyMap& config)> CreateSessionHandler;

    static void RegisterSession       (const char* name, const CreateSessionHandler& handler);
    static void UnregisterSession     (const char* name);
    static void UnregisterAllSessions ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Проверка наличия сессии
///////////////////////////////////////////////////////////////////////////////////////////////////
    static bool IsSessionRegistered (const char* name);
};

}

#endif
