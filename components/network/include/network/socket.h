#ifndef NETWORK_SOCKET_HEADER
#define NETWORK_SOCKET_HEADER

#include <network/socket_address.h>

namespace network
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Протокол, используемый при работе с сокетом
///////////////////////////////////////////////////////////////////////////////////////////////////
enum SocketProtocol
{
  SocketProtocol_Tcp, //TCP
  SocketProtocol_Udp, //UDP
  
  SocketProtocol_Default = SocketProtocol_Tcp
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Домен используемый при работе с сокетом
///////////////////////////////////////////////////////////////////////////////////////////////////
enum SocketDomain
{
  SocketDomain_IpV4, //IPv4
  SocketDomain_IpV6, //IPv6

  SocketDomain_Default = SocketDomain_IpV4
};

class SocketImpl;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Сокет
///////////////////////////////////////////////////////////////////////////////////////////////////
class Socket
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструкторы / деструктор / присваивание
///////////////////////////////////////////////////////////////////////////////////////////////////
    Socket  ();
    Socket  (SocketDomain socket_domain, SocketProtocol protocol = SocketProtocol_Default);
    Socket  (const Socket&);
    ~Socket ();    
    
    Socket& operator = (const Socket&);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Закрытие сокета
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Close ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Адреса сторон
///////////////////////////////////////////////////////////////////////////////////////////////////
    const SocketAddress& LocalAddress  () const;
    const SocketAddress& RemoteAddress () const;
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Протокол
///////////////////////////////////////////////////////////////////////////////////////////////////
    SocketProtocol Protocol () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Закрытие каналов передачи данных
///////////////////////////////////////////////////////////////////////////////////////////////////    
    bool IsReceiveClosed () const;
    bool IsSendClosed    () const;
    void CloseReceive    ();
    void CloseSend       ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Соединение
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Bind    (const SocketAddress& address);
    void Connect (const SocketAddress& address, unsigned int timeout = 0);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Приём соединений
///////////////////////////////////////////////////////////////////////////////////////////////////
    void   Listen    ();
    Socket Accept    ();
    bool   TryAccept (Socket&);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Флаги сокета
///////////////////////////////////////////////////////////////////////////////////////////////////
    bool IsClosed        () const;      //закрыт ли сокет
    bool IsConnected     () const;      //установлена ли связь
    bool IsBound         () const;      //привязан ли сокет
    bool IsKeepAlive     () const;      //установлен ли флаг SO_KEEPALIVE
    bool IsOobInline     () const;      //установлен ли флаг OOBINLINE
    bool IsReuseAddress  () const;      //установлен ли флаг SO_REUSEADDR
    bool IsTcpNoDelay    () const;      //установлен ли флаг TCP_NODELAY
    void SetKeepAlive    (bool state);
    void SetOobInline    (bool state);
    void SetReuseAddress (bool state);
    void SetTcpNoDelay   (bool state);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Параметры сокета
///////////////////////////////////////////////////////////////////////////////////////////////////
    void         SetReceiveBufferSize (unsigned int size);
    void         SetSendBufferSize    (unsigned int size);
    unsigned int ReceiveBufferSize    () const;
    unsigned int SendBufferSize       () const;
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Чтение / запись данных
///////////////////////////////////////////////////////////////////////////////////////////////////
    unsigned int Receive (void* buffer, unsigned int size, unsigned int timeout_in_milliseconds = 0);
    unsigned int Send    (const void* buffer, unsigned int size, unsigned int timeout_in_milliseconds = 0);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Количество байт доступных для чтения без блокировки
///////////////////////////////////////////////////////////////////////////////////////////////////    
    unsigned int ReceiveAvailable () const;
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Обмен
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Swap (Socket&);

  private:
    Socket (SocketImpl* impl);

  private:
    struct Impl;
    Impl* impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Обмен
///////////////////////////////////////////////////////////////////////////////////////////////////
void swap (Socket&, Socket&);

}

#endif
