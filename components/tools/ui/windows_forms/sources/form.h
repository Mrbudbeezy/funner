///////////////////////////////////////////////////////////////////////////////////////////////////
///Базовый класс формы
///////////////////////////////////////////////////////////////////////////////////////////////////
class ToolForm: public xtl::reference_counter, public xtl::dynamic_cast_root
{
  public:
    typedef msclr::gcroot<Form^>         WfFormPtr;
    typedef xtl::intrusive_ptr<ToolForm> Pointer;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    ToolForm (IApplicationServer* server, const WfFormPtr& form);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Изменение текста формы
///////////////////////////////////////////////////////////////////////////////////////////////////
    void        SetText (const stl::string& text);
    stl::string Text    ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Управление видимостью формы
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Show ();
    void Hide ();
    void SetVisible (bool state);
    bool IsVisible ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка меню
///////////////////////////////////////////////////////////////////////////////////////////////////
    void           SetMenuStrip (ToolMenuStrip*);
    ToolMenuStrip* MenuStrip    () { return menu_strip; }
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Регистрация шлюзов
///////////////////////////////////////////////////////////////////////////////////////////////////
    static void RegisterInvokers (script::Environment&);

  protected:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение сервера приложения
///////////////////////////////////////////////////////////////////////////////////////////////////
    IApplicationServer& Server () { return *application_server; }

  private:
    ApplicationServerPtr application_server; //сервер приложения
    WfFormPtr            form;               //связанная форма
    ToolMenuStrip*       menu_strip;         //цепочка меню формы
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Создание форм
///////////////////////////////////////////////////////////////////////////////////////////////////
ToolForm::Pointer create_main_form (IApplicationServer* server); //создание главной формы
