//forward declaration
ref class MainFormImpl;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Главная форма
///////////////////////////////////////////////////////////////////////////////////////////////////
class MainForm: public xtl::reference_counter, public xtl::dynamic_cast_root
{
  public:
    typedef xtl::intrusive_ptr<MainForm> Pointer;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    ~MainForm ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Создание формы
///////////////////////////////////////////////////////////////////////////////////////////////////
    static Pointer Create (WindowSystem& window_system);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Изменение текста формы
///////////////////////////////////////////////////////////////////////////////////////////////////
    void        SetText (const char*);
    const char* Text    ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Управление видимостью формы
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Show       ();
    void Hide       ();
    void SetVisible (bool state);
    bool IsVisible  ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка меню
///////////////////////////////////////////////////////////////////////////////////////////////////
    void                      SetMenuStrip (windows_forms::MenuStrip*);
    windows_forms::MenuStrip* MenuStrip    () { return menu_strip; }

///////////////////////////////////////////////////////////////////////////////////////////////////
///Добавление / удаление панели кнопок
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Insert (windows_forms::ToolStrip*);
    void Remove (windows_forms::ToolStrip*);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Регистрация шлюзов
///////////////////////////////////////////////////////////////////////////////////////////////////
    static void RegisterInvokers (script::Environment&, const char* library_name);
    
  private:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    MainForm (WindowSystem& window_system);

  private:
    typedef msclr::gcroot<MainFormImpl^> HandlePtr;    

  private:
    WindowSystem&             window_system; //оконная система
    HandlePtr                 form;          //дескриптор формы
    windows_forms::MenuStrip* menu_strip;    //цепочка меню формы
    AutoString                text;          //текст формы
};
