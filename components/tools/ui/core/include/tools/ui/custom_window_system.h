#ifndef TOOLS_UI_CUSTOM_WINDOW_SYSTEM_HEADER
#define TOOLS_UI_CUSTOM_WINDOW_SYSTEM_HEADER

#include <stl/string_fwd>
#include <xtl/functional_fwd>

namespace tools
{

namespace ui
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Пользовательская оконная система
///////////////////////////////////////////////////////////////////////////////////////////////////
class ICustomWindowSystem
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Выполнение команды на стороне оконной системы
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void ExecuteCommand (const char* command) = 0;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Подсчёт ссылок
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void AddRef  () = 0;
    virtual void Release () = 0;

  protected:
    virtual ~ICustomWindowSystem () {}
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Слушатель изменений сетки свойств
///////////////////////////////////////////////////////////////////////////////////////////////////
class IPropertyListener
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///События
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void OnAddProperty    (const char* name) = 0;
    virtual void OnChangeProperty (const char* name) = 0;
    virtual void OnRemoveProperty (const char* name) = 0;

  protected:
    virtual ~IPropertyListener () {}
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Интерфейс приложения, используемый при работе оконной системы
///////////////////////////////////////////////////////////////////////////////////////////////////
class IApplicationServer
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Выполнение команды на стороне приложения
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void ExecuteCommand (const char* command) = 0;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение / установка значения свойства
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void SetProperty (const char* name, const stl::string& value) = 0;
    virtual void GetProperty (const char* name, stl::string& value) = 0;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Проверка наличия свойства / проверка режима "только чтения" свойства
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual bool IsPropertyPresent  (const char* name) = 0;
    virtual bool IsPropertyReadOnly (const char* name) = 0;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Регистрация слушателей событий свойств
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void RegisterPropertyListener       (const char* name_wc_mask, IPropertyListener* listener) = 0;
    virtual void UnregisterPropertyListener     (const char* name_wc_mask, IPropertyListener* listener) = 0;
    virtual void UnregisterAllPropertyListeners (const char* name_wc_mask) = 0;
    virtual void UnregisterAllPropertyListeners () = 0;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Подсчёт ссылок
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void AddRef  () = 0;
    virtual void Release () = 0;

  protected:
    virtual ~IApplicationServer () {}
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Менеджер оконных систем
///////////////////////////////////////////////////////////////////////////////////////////////////
class WindowSystemManager
{
  public:
    typedef xtl::function<ICustomWindowSystem* (const char* profile, IApplicationServer* application)> WindowSystemCreater;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Регистрация пользовательских оконных систем
///////////////////////////////////////////////////////////////////////////////////////////////////
    static void RegisterWindowSystem       (const char* profile, const WindowSystemCreater& creater);
    static void UnregisterWindowSystem     (const char* profile);
    static void UnregisterAllWindowSystems ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Регистрация приложений
///////////////////////////////////////////////////////////////////////////////////////////////////
    static void RegisterApplicationServer       (const char* application_server_name, IApplicationServer* server);
    static void UnregisterApplicationServer     (const char* application_server_name);
    static void UnregisterAllApplicationServers ();
    
};

}

}

#endif
