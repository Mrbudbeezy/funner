#ifndef PUSH_NOTIFICATIONS_CENTER_HEADER
#define PUSH_NOTIFICATIONS_CENTER_HEADER

namespace common
{

//forward declaration
class PropertyMap;

}

namespace push_notifications
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Push notifications processing center
///////////////////////////////////////////////////////////////////////////////////////////////////
class PushNotificationsCenter
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Constructor/ destructor / copying
///////////////////////////////////////////////////////////////////////////////////////////////////
    PushNotificationsCenter  (const char* center_name);
    PushNotificationsCenter  (const PushNotificationsCenter& source);
    ~PushNotificationsCenter ();

    PushNotificationsCenter& operator = (const PushNotificationsCenter& source);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Description
///////////////////////////////////////////////////////////////////////////////////////////////////
    const char* Description () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Registration for push notifications
///////////////////////////////////////////////////////////////////////////////////////////////////
    typedef xtl::function<void (bool success, const char* status, const char* token)> RegisterCallback;

    void RegisterForNotifications   (const RegisterCallback& callback, const common::PropertyMap& properties = common::PropertyMap ());
    void UnregisterForNotifications ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Registration for new push notifications
///////////////////////////////////////////////////////////////////////////////////////////////////
    typedef xtl::function<void (const char*)> NotificationsHandler;
    
    xtl::connection RegisterNotificationsHandler (const NotificationsHandler&);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Swap
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Swap (PushNotificationsCenter&);

  private:
    struct Impl;
    Impl* impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Swap
///////////////////////////////////////////////////////////////////////////////////////////////////
void swap (PushNotificationsCenter&, PushNotificationsCenter&);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Push notifications processing center
///////////////////////////////////////////////////////////////////////////////////////////////////
class IPushNotificationsCenter
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Destructor
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual ~IPushNotificationsCenter () {}

///////////////////////////////////////////////////////////////////////////////////////////////////
///Description
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual const char* Description () = 0;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Registration for push notifications
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void RegisterForNotifications   (const PushNotificationsCenter::RegisterCallback& callback, const common::PropertyMap& properties) = 0;
    virtual void UnregisterForNotifications () = 0;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Registration for new push notifications
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual xtl::connection RegisterNotificationsHandler (const PushNotificationsCenter::NotificationsHandler&) = 0;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Push notifications processing centers manager
///////////////////////////////////////////////////////////////////////////////////////////////////
class PushNotificationsCentersManager
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Registrationg of push notifications centers creators
///////////////////////////////////////////////////////////////////////////////////////////////////
    typedef xtl::function<IPushNotificationsCenter* (const char* center_name)> CreateCenterHandler;

    static void RegisterCenter       (const char* id, const char* center_name_mask, const CreateCenterHandler& handler);
    static void UnregisterCenter     (const char* id);
    static void UnregisterAllCenters ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Check push notifications center existence
///////////////////////////////////////////////////////////////////////////////////////////////////
    static bool IsCenterRegistered (const char* center_name);
};

}

#endif
