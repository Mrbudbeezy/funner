#ifndef MEDIALIB_GEOMETRY_VERTEX_BUFFER_HEADER
#define MEDIALIB_GEOMETRY_VERTEX_BUFFER_HEADER

#include <media/geometry/vertex_stream.h>

namespace media
{

namespace geometry
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Вершинный буфер
///////////////////////////////////////////////////////////////////////////////////////////////////
class VertexBuffer
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструкторы / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    VertexBuffer  ();
    VertexBuffer  (const VertexBuffer&);
    ~VertexBuffer ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Присваивание
///////////////////////////////////////////////////////////////////////////////////////////////////
    VertexBuffer& operator = (const VertexBuffer&);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Создание копии
///////////////////////////////////////////////////////////////////////////////////////////////////
    VertexBuffer Clone () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Идентификатор буфера (уникальный)
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t Id () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Количество массивов вершинных атрибутов
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t StreamsCount () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение массива
///////////////////////////////////////////////////////////////////////////////////////////////////
    const VertexStream& Stream (size_t index) const;
          VertexStream& Stream (size_t index);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение массива весов
///////////////////////////////////////////////////////////////////////////////////////////////////
    const VertexWeightStream& Weights () const;
          VertexWeightStream& Weights ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Присоединение/отсоединение массивов
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t Attach        (VertexStream&); //return: индекс массива
    void   Detach        (size_t index);  //nothrow
    void   AttachWeights (VertexWeightStream&);
    void   DetachWeights ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Очистка буфера
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Clear ();    

///////////////////////////////////////////////////////////////////////////////////////////////////
///Количество вершин (минимум среди всех вершинных массивов)
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t VerticesCount () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Суммарный размер вершины
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t VertexSize () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Обмен
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Swap (VertexBuffer&);

  private:
    struct Impl;
    
    VertexBuffer (Impl*);
    
  private:
    xtl::intrusive_ptr<Impl> impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Обмен
///////////////////////////////////////////////////////////////////////////////////////////////////
void swap (VertexBuffer&, VertexBuffer&);

}

}

#endif
