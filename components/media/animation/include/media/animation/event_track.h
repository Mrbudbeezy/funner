#ifndef MEDIALIB_ANIMATION_EVENT_QUEUE_HEADER
#define MEDIALIB_ANIMATION_EVENT_QUEUE_HEADER

#include <cstddef>

#include <xtl/functional_fwd>

namespace media
{

namespace animation
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Трек событий анимации
///////////////////////////////////////////////////////////////////////////////////////////////////
class EventTrack
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструкторы / деструктор / присваивание
///////////////////////////////////////////////////////////////////////////////////////////////////
    EventTrack  ();
    EventTrack  (const EventTrack&);
    ~EventTrack ();

    EventTrack& operator = (const EventTrack&);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Копирование
///////////////////////////////////////////////////////////////////////////////////////////////////
    EventTrack Clone () const;
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Идентификатор
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t Id () const;
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Количество событий
///////////////////////////////////////////////////////////////////////////////////////////////////
    unsigned int Size () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Резервирование числа событий
///////////////////////////////////////////////////////////////////////////////////////////////////    
    unsigned int Capacity () const;
    void         Reserve  (unsigned int events_count);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Минимальное / максимальное время
///////////////////////////////////////////////////////////////////////////////////////////////////    
    float MinTime () const;
    float MaxTime () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Минимальное / максимальное неотсеченное время (-INF/INF в случае открытого диапазона)
///////////////////////////////////////////////////////////////////////////////////////////////////
    float MinUnwrappedTime () const;
    float MaxUnwrappedTime () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Добавление / изменение событий
///////////////////////////////////////////////////////////////////////////////////////////////////
    unsigned int AddEvent  (float delay, float period, const char* event);
    void         SetDelay  (unsigned int event_index, float delay);
    void         SetPeriod (unsigned int event_index, float period);
    void         SetEvent  (unsigned int event_index, float delay, float period, const char* event);
    void         SetEvent  (unsigned int event_index, const char* event);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение событий
///////////////////////////////////////////////////////////////////////////////////////////////////
    const char* GetEvent  (unsigned int event_index) const;
    float       GetDelay  (unsigned int event_index) const;
    float       GetPeriod (unsigned int event_index) const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Перечисление событий, прошедших в указанном промежутке времени
///////////////////////////////////////////////////////////////////////////////////////////////////
    typedef xtl::function<void (float time, const char* event)> EventHandler;

    void GetEvents (float previous_time, float current_time, const EventHandler& handler) const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Удаление ключевых точек
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Remove (unsigned int event_index);
    void Clear  ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Обмен
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Swap (EventTrack&);

  private:
    struct Impl;
    
    EventTrack (Impl*);
    
  private:
    Impl* impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Обмен
///////////////////////////////////////////////////////////////////////////////////////////////////
void swap (EventTrack&, EventTrack&);

}

}

#endif
