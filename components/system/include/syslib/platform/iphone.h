#ifndef SYSLIB_PLATFORM_IPHONE_HEADER
#define SYSLIB_PLATFORM_IPHONE_HEADER

#include <syslib/window.h>

namespace syslib
{

namespace iphone
{

struct touch_handle;

typedef touch_handle* touch_t;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Описание одного касания
///////////////////////////////////////////////////////////////////////////////////////////////////
struct TouchDescription
{
  touch_t touch;       //идентификатор касания
  float   x;           //текущее положение пальца относительно окна (0 - у левой границы окна, 1 - у правой)
  float   y;           //текущее положение пальца относительно окна (0 - у верхней границы окна, 1 - у нижней)
  size_t  tap_count;   //количество касаний
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Ориентации устройства
///////////////////////////////////////////////////////////////////////////////////////////////////
enum InterfaceOrientation
{
  InterfaceOrientation_Portrait           = 1,      //портретная ориентация (кнопка Home снизу)
  InterfaceOrientation_PortraitUpsideDown = 1 << 1, //портретная ориентация (кнопка Home сверху)
  InterfaceOrientation_LandscapeLeft      = 1 << 2, //альбомная ориентация (кнопка Home слева)
  InterfaceOrientation_LandscapeRight     = 1 << 3, //альбомная ориентация (кнопка Home справа)

  InterfaceOrientation_Unknown            = 1 << 4
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Интерфейс слушателя событий окна
///////////////////////////////////////////////////////////////////////////////////////////////////
class IWindowListener
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///События касания
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void OnTouchesBegan (size_t touches_count, const TouchDescription* touches) {} //один или несколько пальцев дотронулись до окна
    virtual void OnTouchesMoved (size_t touches_count, const TouchDescription* touches) {} //один или несколько пальцев двигаются в окне
    virtual void OnTouchesEnded (size_t touches_count, const TouchDescription* touches) {} //один или несколько пальцев поднялись с окна

///////////////////////////////////////////////////////////////////////////////////////////////////
///События разворота
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void OnInterfaceOrientationWillChange (InterfaceOrientation old_orientation, InterfaceOrientation new_orientation, float duration) {} //ориентация интерфейса окна начала изменяться
    virtual void OnInterfaceOrientationChanged    (InterfaceOrientation old_orientation, InterfaceOrientation new_orientation) {}                 //изменилась ориентация интерфейса окна

///////////////////////////////////////////////////////////////////////////////////////////////////
///События движения
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void OnShakeMotionBegan () {} //пользователь начал жест "тряски" телефона
    virtual void OnShakeMotionEnded () {} //пользователь закончил жест "тряски" телефона

  protected:
    virtual ~IWindowListener () {}
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Менеджер окон
///////////////////////////////////////////////////////////////////////////////////////////////////
class WindowManager
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Добавление/удаление подписчиков на события окна
///////////////////////////////////////////////////////////////////////////////////////////////////
    static void AttachWindowListener (const Window& window, IWindowListener* listener);
    static void DetachWindowListener (const Window& window, IWindowListener* listener);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка/получение multitouch режима для окна
///////////////////////////////////////////////////////////////////////////////////////////////////
    static void SetMultitouchEnabled (const Window& window, bool enabled);
    static bool GetMultitouchEnabled (const Window& window);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка/получение разрешенных ориентаций окна
///////////////////////////////////////////////////////////////////////////////////////////////////
    static void SetAllowedOrientations (const Window& window, int orientations);
    static int  GetAllowedOrientations (const Window& window);
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Интерфейс слушателя событий приложения
///////////////////////////////////////////////////////////////////////////////////////////////////
class IApplicationListener
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///События
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void OnMemoryWarning () {}   //нехватка памяти
    virtual void OnActive        () {}   //приложение стало активным
    virtual void OnInactive      () {}   //приложение стало неактивным

  protected:
    virtual ~IApplicationListener () {}
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Менеджер приложения
///////////////////////////////////////////////////////////////////////////////////////////////////
class ApplicationManager
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Добавление/удаление подписчиков на события приложения
///////////////////////////////////////////////////////////////////////////////////////////////////
    static void AttachApplicationListener (IApplicationListener* listener);
    static void DetachApplicationListener (IApplicationListener* listener);
};

}

}

#endif
