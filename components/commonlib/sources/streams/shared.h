#ifndef STREAMS_SHARED_HEADER
#define STREAMS_SHARED_HEADER

#include <common/streams.h>
#include <common/wxf_writer.h>
#include <common/exception.h>
#include <common/strwrap.h>
#include <common/file.h>
#include <xtl/function.h>
#include <string.h>

namespace common
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Буфер
///////////////////////////////////////////////////////////////////////////////////////////////////
class StreamBuffer
{
  public:
    StreamBuffer  ();
    ~StreamBuffer ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка пользовательского буфера
///////////////////////////////////////////////////////////////////////////////////////////////////
    void SetUserBuffer (void* buffer, size_t size);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Размер буфера / изменение размера буфера
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t Size    () const { return visible_size; }
    void   Resize  (size_t size, size_t initialized_size=0);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Данные
///////////////////////////////////////////////////////////////////////////////////////////////////
    void* Data () const { return buffer; }
    
  private:
    StreamBuffer (const StreamBuffer&); //no impl
    StreamBuffer& operator = (const StreamBuffer&); //no impl
    
    void SetBuffer (void* buffer, size_t size, bool is_user_buffer);

  private:
    bool   is_user_buffer; //является ли буфер пользовательским
    void*  buffer;         //указатель на начало буфера
    size_t buffer_size;    //размер буфера
    size_t visible_size;   //видимый размер
};

}

#endif
