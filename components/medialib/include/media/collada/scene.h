#ifndef MEDIALIB_COLLADA_SCENE_HEADER
#define MEDIALIB_COLLADA_SCENE_HEADER

#include <math/mathlib.h>
#include "base.h"
#include "geometry.h"
#include "controller.h"

//продумать поиск по SubID!!

namespace medialib
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Тип источника света
///////////////////////////////////////////////////////////////////////////////////////////////////
enum ColladaLightType
{
  COLLADA_LIGHT_AMBIENT, //рассеянное освещение
  COLLADA_LIGHT_POINT,   //точечный источник света
  COLLADA_LIGHT_SPOT,    //направленный конусоидальный источник света
  COLLADA_LIGHT_DIRECT   //направленный цилиндрический источник света
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Тип камеры
///////////////////////////////////////////////////////////////////////////////////////////////////
enum ColladaCameraType
{
  COLLADA_CAMERA_PERSPECTIVE, //перспективная камера
  COLLADA_CAMERA_ORTHOGRAPHIC //ортографическая камера
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Источник света
///////////////////////////////////////////////////////////////////////////////////////////////////
class ColladaLight: public ColladaEntity
{
  friend class ColladaWrappers;
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Тип источника
///////////////////////////////////////////////////////////////////////////////////////////////////
    ColladaLightType LightType () const;
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Цвет источника
///////////////////////////////////////////////////////////////////////////////////////////////////
    const math::vec3f& Color ();
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Параметры затухания
///////////////////////////////////////////////////////////////////////////////////////////////////
    float AttenuationConstant  () const;
    float AttenuationLinear    () const;
    float AttenuationQuadratic () const;
    float FalloffAngle         () const;
    float FalloffExponent      () const;
    
  private:
    ColladaLight (const ColladaLightImpl*);

  private:
    const ColladaLightImpl* impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Камера
///////////////////////////////////////////////////////////////////////////////////////////////////
class ColladaCamera: public ColladaEntity
{
  friend class ColladaWrappers;
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Тип камеры
///////////////////////////////////////////////////////////////////////////////////////////////////
    ColladaCameraType CameraType () const;
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Параметры камеры
///////////////////////////////////////////////////////////////////////////////////////////////////
    float ZNear       () const;
    float ZFar        () const;
    float AspectRatio () const;
    float XFov        () const;
    float YFov        () const;
    float MagnitudeX  () const;
    float MagnitudeY  () const;

   private:
     ColladaCamera (const ColladaCameraImpl*);

   private:
     const ColladaCameraImpl* impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Инстанцированный материал
///////////////////////////////////////////////////////////////////////////////////////////////////
class ColladaInstanceMaterial
{
  friend class ColladaWrappers;
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Материал
///////////////////////////////////////////////////////////////////////////////////////////////////
    ColladaMaterial Material ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Текстурные каналы
///////////////////////////////////////////////////////////////////////////////////////////////////
    const char* TextureChannelName (const char* texture_name) const;
    size_t      TextureChannel     (const char* texture_name) const;

  private:
    ColladaInstanceMaterial (const ColladaInstanceMaterialImpl*);

  private:
    const ColladaInstanceMaterialImpl* impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Инстанцированный контроллер
///////////////////////////////////////////////////////////////////////////////////////////////////
class ColladaInstanceController
{
  friend class ColladaWrappers;
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Контроллер
///////////////////////////////////////////////////////////////////////////////////////////////////  
    ColladaController Controller () const;
  
///////////////////////////////////////////////////////////////////////////////////////////////////
///Ссылки на корни поиска узлов для скининга
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t      SkeletonsCount () const;
    ColladaNode Skeleton       (size_t skeleton_index) const;  

///////////////////////////////////////////////////////////////////////////////////////////////////
///Поиск джойнта
///////////////////////////////////////////////////////////////////////////////////////////////////
    ColladaNode Joint (const char* name) const;

  private:
    ColladaInstanceController (const ColladaInstanceControllerImpl*);

  private:
    const ColladaInstanceControllerImpl* impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Узел сцены
///////////////////////////////////////////////////////////////////////////////////////////////////
class ColladaNode: public ColladaEntity
{
  friend class ColladaWrappers;
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Идентификатор узла в пределах родительского узла / имя узла
///////////////////////////////////////////////////////////////////////////////////////////////////  
    const char* SubID () const;
    const char* Name  () const;
  
///////////////////////////////////////////////////////////////////////////////////////////////////
///Преобразование узла
///////////////////////////////////////////////////////////////////////////////////////////////////
    const math::mat4f& GetTransform () const;
  
///////////////////////////////////////////////////////////////////////////////////////////////////
///Потомки
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t      ChildrenCount () const;
    ColladaNode Child         (size_t node_index) const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Слои которым принадлежит узел
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t      LayersCount () const;
    const char* Layer       (size_t layer_index) const;
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Камеры
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t        CamerasCount () const;
    ColladaCamera Camera       (size_t camera_index) const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Источники света
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t       LightsCount () const;
    ColladaLight Light       (size_t light_index) const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Меши
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t                  MeshesCount  () const;
    ColladaMesh             Mesh         (size_t mesh_index) const;
    ColladaInstanceMaterial MeshMaterial (size_t mesh_index,const char* material_name) const;
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Контроллеры
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t                    ControllersCount   () const;
    ColladaInstanceController Controller         (size_t controller_index) const;
    ColladaInstanceMaterial   ControllerMaterial (size_t controller_index,const char* material_name) const;

  private:
    ColladaNode (const ColladaNodeImpl*);

  private:
    const ColladaNodeImpl* impl;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Визуальная сцена
///////////////////////////////////////////////////////////////////////////////////////////////////
class ColladaVisualScene: public ColladaEntity
{
  friend class ColladaWrappers;
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Перечисление узлов принадлежащих сцене
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t      NodesCount ();
    ColladaNode Node       (size_t index);
    ColladaNode Node       (const char* name);
  
  private:
    ColladaVisualScene (const ColladaVisualSceneImpl*);

  private:
    const ColladaVisualSceneImpl* impl;    
};

}

#endif
