#ifndef MEDIALIB_FONT_HEADER
#define MEDIALIB_FONT_HEADER

#include <tr1/memory>
#include <tr1/functional_fwd>

namespace medialib
{

//implementation forwards
class FontFaceImpl;

//////////////////////////////////////////////////////////////////////////////////////////////////
///Информация о глифе
//////////////////////////////////////////////////////////////////////////////////////////////////
struct GlyphInfo
{
  size_t x_pos;      //X координата нижнего левого угла глифа
  size_t y_pos;      //Y координата нижнего левого угла глифа
  size_t width;      //Ширина глифа
  size_t heigth;     //Высота глифа
  int    bearingX;   //Расстояние от положения пера до левой границы буквы
  int    bearingY;   //Расстояние от положения пера до верхней границы буквы
  int    advanceX;   //Отступ по оси X от текущего положения пера до следующего положения пера
  int    advanceY;   //Отступ по оси Y от текущего положения пера до следующего положения пера
};

//////////////////////////////////////////////////////////////////////////////////////////////////
///Информация о уменьшенных межзнаковых интервалах
//////////////////////////////////////////////////////////////////////////////////////////////////
struct KerningInfo
{
  int x_kerning;     //Отступ по оси X от положения пера для отображения левого глифа до положения пера для отображения правого глифа
  int y_kerning;     //Отступ по оси Y от положения пера для отображения левого глифа до положения пера для отображения правого глифа
};

//////////////////////////////////////////////////////////////////////////////////////////////////
///Гарнитура
//////////////////////////////////////////////////////////////////////////////////////////////////
class FontFace
{
  public:
             FontFace  ();
             FontFace  (size_t first_char_index, size_t glyph_table_size, GlyphInfo* glyph, KerningInfo* kerning_table, const char* font_file_name);
             FontFace  (const FontFace& source);
    explicit FontFace  (const char* file_name);
             ~FontFace ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Загрузка
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Load (const char* file_name);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Присваивание
///////////////////////////////////////////////////////////////////////////////////////////////////
    FontFace& operator = (const FontFace&);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Имя сэмпла
///////////////////////////////////////////////////////////////////////////////////////////////////
    const char* Name   () const;
    void        Rename (const char* new_name);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Данные
///////////////////////////////////////////////////////////////////////////////////////////////////
    const char*                ImageName      () const;
    size_t                     GlyphsCount    () const;
    size_t                     FirstGlyphCode () const;
    GlyphInfo*                 GlyphData      (size_t glyph_index) const;
    GlyphInfo*                 GlyphData      () const;
    KerningInfo*               Kerning        (size_t left_glyph_index, size_t right_glyph_index) const;
    KerningInfo*               Kerning        () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Обмен
///////////////////////////////////////////////////////////////////////////////////////////////////
    void Swap (FontFace&);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Обработчик загрузки гарнитур по умолчанию
///////////////////////////////////////////////////////////////////////////////////////////////////
    static FontFace* DefaultBFSLoader (const char* file_name);

  private:
    FontFace (FontFaceImpl*);

    tr1::shared_ptr<FontFaceImpl> impl;
};

//////////////////////////////////////////////////////////////////////////////////////////////////
///Обмен
//////////////////////////////////////////////////////////////////////////////////////////////////
void swap (FontFace&,FontFace&);

//////////////////////////////////////////////////////////////////////////////////////////////////
///Система управления шрифтами
//////////////////////////////////////////////////////////////////////////////////////////////////
class FontSystem
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Регистрация пользовательских функций загрузки
///////////////////////////////////////////////////////////////////////////////////////////////////
    typedef tr1::function<FontFace* (const char* file_name)> CodecLoadFunc;

    static bool RegisterCodec       (const char* extension, const CodecLoadFunc& loader);  //возвращает true при успешной регистрации, и false, если такое расширение уже зарегестрировано
    static void UnregisterCodec     (const char* extension);
    static void UnregisterAllCodecs ();
};

}

#endif
